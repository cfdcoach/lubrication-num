	PROGRAM GREASELINEEHL
	CHARACTER*1 S,S1,S2
	CHARACTER*16 CDATE,CTIME
	COMMON /COM1/ENDA,A1,A2,A3,Z,C1,C3,CW,LMAX,FF/COM2/EDA0/COM4/X0,XE/COM3/E1,PH,B,U1,U2,R
	DATA PAI,Z,P0/3.14159265,0.68,1.96E8/S1,S2/1HY,1Hy/
	DATA N,X0,XE,W,E1,EDA0,R,Us,CU,C1,FN/129,-4.,1.4,1.E5,2.26E11,0.4,0.012183,0.87,0.67,0.5,1.0/CDATE,CTIME/'The date is','The time is'/
    OPEN(8,FILE='OUT.DAT',STATUS='UNKNOWN')
1   FORMAT(20X,A12,I2.2,':',I2.2,':',I4.4)
2   FORMAT(20X,A12,I2.2,':',I2.2,':',I2.2,'.',I2.2)
	WRITE(*,*)'Show the example or not (Y or N)?'
	READ(*,'(A)')S
	IF(S.EQ.S1.OR.S.EQ.S2)THEN
	GOTO 10
	ENDIF
	WRITE(*,*)'PH='
	READ(*,*)PH
	W=2.*PAI*R*PH*(PH/E1)
	WRITE(*,*)'W=',W
10  CW=N+0.1
    FF=1./FN
	LMAX=ALOG(CW)/ALOG(2.)
	N=2**LMAX+1
	LMIN=(ALOG(CW)-ALOG(SQRT(CW)))/ALOG(2.)
	LMAX=LMIN
	W1=W/(E1*R)
	PH=E1*SQRT(0.5*W1/PAI)
	A1=(ALOG(EDA0)+9.67)
	A2=PH/P0
	A3=0.59/(PH*1.E-9)
	B=4.*R*PH/E1
	ALFA=Z*A1/P0
	G=ALFA*E1
	U=EDA0*US/(2.*E1*R)
	C3=1.6*(R/B)**2*G**0.6*U**0.7*W1**(-0.13)
	ENDA=B**(2.+FF)*(PH/2/EDA0)**FF/R**(1+FF)/US/(2.+FF)
	U1=0.5*(2.+CU)*U
	U2=0.5*(2.-CU)*U
    WRITE(*,*)'B,PH,G,U=',B,PH,G,U
	CW=-1.13*C3
	WRITE(*,*)N,X0,XE,W,E1,EDA0,R,US,PH
	WRITE(8,*)N,W,E1,EDA0,R,US,B,PH,FF
	WRITE(*,40)
40  FORMAT(2X,'Wait  Please',//)
	CALL SUBAK(N)
	CALL MULTI(N)
	STOP
	END
	SUBROUTINE MULTI(N)
	REAL*8 X(1100),P(1100),H(1100),RO(1100),POLD(1100),EPS(1100),EDA(1100),R(1100),K(1100),E(1100)
	COMMON /COM1/ENDA,A1,A2,A3,Z,C1,C3,CW,LMAX,FF/COM4/X0,XE/COM3/E1,PH,B,U1,U2,RR
	DATA MK,G0/1,1.570796325/
	NX=N
	DX=(XE-X0)/(N-1.0)
	DO 10 I=1,N
	X(I)=X0+(I-1)*DX
	IF(ABS(X(I)).GE.1.0)P(I)=0.0
	IF(ABS(X(I)).LT.1.0)P(I)=SQRT(1.-X(I)*X(I))
10  CONTINUE
	CALL HREE(N,DX,H00,G0,X,P,H,RO,EPS,EDA)
	CALL FZ(N,P,POLD)
14	KK=19
	CALL ITER(N,KK,DX,H00,G0,X,P,H,RO,EPS,EDA,R)
	MK=MK+1
	CALL ERROP(N,P,POLD,ERP)
	IF(ERP.GT.1.E-4.AND.MK.LE.800)THEN
	GOTO 14
	ENDIF
	WRITE(*,*)PH,RR,B
105	IF(MK.GE.800)THEN
	WRITE(*,*)'Pressures are not convergent !!!'
	READ(*,*)
	ENDIF
	FM=FRICT(N,DX,X,H,P,EDA)
	H2=1.E3
	P2=0.0
	DO 106 I=1,N
	IF(H(I).LT.H2)H2=H(I)
	IF(P(I).GT.P2)P2=P(I)
106 CONTINUE
    DO 108 I=1,N
    K(I)=P(I)*PH/1.E9
	E(I)=H(I)*B*B*1.E6/RR
108 CONTINUE
	H3=H2*B*B/RR
	P3=P2*PH
110	FORMAT(6(1X,E12.6))
120	CONTINUE
	WRITE(8,*)'P2,H2,P3,H3=',P2,H2,P3,H3
	CALL OUTHP(N,X, K,E)
	RETURN
	END
	SUBROUTINE OUTHP(N,X, K,E)
	REAL*8  X(N), K(N),E(N)
	DX=X(2)-X(1)
	DO 10 I=1,N
	WRITE(8,20)X(I),K(I),E(I)
10  CONTINUE
20  FORMAT(1X,6(F20.6,1X))
	RETURN
	END
	SUBROUTINE HREE(N,DX,H00,G0,X,P,H,RO,EPS,EDA)
    REAL*8  X(N),P(N),H(N),RO(N),EPS(N),EDA(2200)
	REAL*8  W(2200)
	COMMON /COM1/ENDA,A1,A2,A3,Z,C1,C3,CW,K,FF/COM2/EDA0/COMAK/AK(0:1100)
    DATA KK,NW,PAI1/0,2200,0.318309886/
	IF(KK.NE.0)GOTO 3
	HM0=C3
	H00=0.0
3	W1=0.0
	DO 4 I=1,N
4   W1=W1+P(I)
	C3=(DX*W1)/G0
	DW=1.-C3
	CALL DISP(N,NW,K,DX,P,W)
	HMIN=1.E3
	DO 30 I=1,N
	H0=0.5*X(I)*X(I)-PAI1*W(I)
	IF(H0.LT.HMIN)HMIN=H0
	H(I)=H0
30	CONTINUE
	IF(KK.NE.0)GOTO 32
	KK=1
	H00=-HMIN+HM0
32	H0=H00+HMIN
	IF(H0.LE.0.0)GOTO 48
	IF(H0+0.3*CW*DW.GT.0.0)HM0=H0+0.3*CW*DW
	IF(H0+0.3*CW*DW.LE.0.0)HM0=HM0*C3
48	H00=HM0-HMIN
50	DO 60 I=1,N
60	H(I)=H00+H(I)
	DO 100 I=1,N
	EDA(I)=EXP(A1*(-1.+(1.+A2*P(I))**Z))
	RO(I)=1.0
	EPS(I)=RO(I)*H(I)**(2+FF)*ENDA/EDA(I)**FF
100	CONTINUE
	RETURN
	END
	SUBROUTINE ITER(N,KK,DX,H00,G0,X,P,H,RO,EPS,EDA,R)
	REAL*8 X(N),P(N),H(N),RO(N),EPS(N),EDA(N),R(N)
	COMMON /COM1/ENDA,A1,A2,A3,Z,C1,C3,CW,LMAX,FF/COMAK/AK(0:1100)
	DATA KG1,PAI/0,3.14159265/
	IF(KG1.NE.0)GOTO 5
	KG1=1
	DX1=1./DX
	DX2=DX*DX
	DX3=1./DX2
	DX4=DX1/PAI
	DX5=DX1**(1+FF)
	DXL=DX*ALOG(DX)
	AK0=DX*AK(0)+DXL
	AK1=DX*AK(1)+DXL
5	DO 100 K=1,KK
	D2=0.5*(EPS(1)+EPS(2))
	D3=0.5*(EPS(2)+EPS(3))
	D5=DX1*(RO(2)*H(2)-RO(1)*H(1))
	D7=DX4*(RO(2)*AK0-RO(1)*AK1)
	PP=0.
	DO 70 I=2,N-1
	D1=D2
	D2=D3
	D4=D5
	D6=D7
	IF(I+2.LE.N)D3=0.5*(EPS(I+1)+EPS(I+2))
	D5=DX1*(RO(I+1)*H(I+1)-RO(I)*H(I))
	D7=DX4*(RO(I+1)*AK0-RO(I)*AK1)
	DD=(D1+D2)*DX3
	IF(0.05*DD.LT.ABS(D6))GOTO 10
	RI=-DX5*(D2*SIGN(1.0,(P(I+1)-P(I)))*ABS((P(I+1)-P(I)))**(FF)-D1*SIGN(1.0,(P(I)-P(I-1)))*ABS((P(I)-P(I-1)))**(FF))+D4
	R(I)=RI
	DLDP=-FF*DX5*(D1*ABS((P(I)-P(I-1)))**(FF-1)+D2*ABS((P(I+1)-P(I)))**(FF-1))+D6
	RI=RI/DLDP
	RI=RI/C1
	GOTO 20
10	RI=-DX5*(D2*SIGN(1.0,(P(I+1)-P(I)))*ABS((P(I+1)-P(I)))**(FF)-D1*SIGN(1.0,(P(I)-PP))*ABS((P(I)-PP))**(FF))+D4
	R(I)=RI
	DLDP=-FF*DX5*(2*D1*ABS((P(I)-PP))**(FF-1)+D2*ABS((P(I+1)-P(I)))**(FF-1))+2.*D6
	RI=RI/DLDP

	IF(I.GT.2.AND.P(I-1)-C1*RI.GT.0)P(I-1)=P(I-1)-C1*RI
20  PP=P(I)
	P(I)=P(I)+C1*RI
	IF(P(I).LT.0.0)P(I)=0.0
	IF(P(I).LE.0.0)R(I)=0.0
70	CONTINUE
	CALL HREE(N,DX,H00,G0,X,P,H,RO,EPS,EDA)
100 CONTINUE
	RETURN
	END
	SUBROUTINE DISP(N,NW,KMAX,DX,P1,W)
	REAL*8 P1(N),W(NW),P(2200),AK1(0:50),AK2(0:50)
	COMMON /COMAK/AK(0:1100)
	DATA NMAX,KMIN/2200,1/
	N2=N
	M=3+2*ALOG(FLOAT(N))
	K1=N+KMAX
	DO 10 I=1,N
10  P(K1+I)=P1(I)
	DO 20 KK=KMIN,KMAX-1
	K=KMAX+KMIN-KK
	N1=(N2+1)/2
	CALL DOWNP(NMAX,N1,N2,K,P)
20	N2=N1
	DX1=DX*2**(KMAX-KMIN)
	CALL WI(NMAX,N1,KMIN,KMAX,DX,DX1,P,W)
	DO 30 K=KMIN+1,KMAX
	N2=2*N1-1
	DX1=DX1/2.
	CALL AKCO(M+5,KMAX,K,AK1)
	CALL AKIN(M+6,AK1,AK2)
	CALL WCOS(NMAX,N1,N2,K,W)
	CALL CORR(NMAX,N2,K,M,1,DX1,P,W,AK1)
	CALL WINT(NMAX,N2,K,W)
	CALL CORR(NMAX,N2,K,M,2,DX1,P,W,AK2)
30  N1=N2
	DO 40 I=1,N
40  W(I)=W(K1+I)
	RETURN
	END
	SUBROUTINE DOWNP(NMAX,N1,N2,K,P)
	REAL*8 P(NMAX)
	K1=N1+K-1
	K2=N2+K-1
	DO 10 I=3,N1-2
	I2=2*I+K2
10  P(K1+I)=(16.*P(I2)+9.*(P(I2-1)+P(I2+1))-(P(I2-3)+P(I2+3)))/32.
	P(K1+2)=0.25*(P(K2+3)+P(K2+5))+0.5*P(K2+4)
	P(K1+N1-1)=0.25*(P(K2+N2-2)+P(K2+N2))+0.5*P(K2+N2-1)
	RETURN
	END
	SUBROUTINE WCOS(NMAX,N1,N2,K,W)
	REAL*8 W(NMAX)
	K1=N1+K-1
	K2=N2+K
	DO 10 I=1,N1
	II=2*I-1
10  W(K2+II)=W(K1+I)
	RETURN
	END
	SUBROUTINE WINT(NMAX,N,K,W)
	REAL*8 W(NMAX)
	K2=N+K
	DO 10 I=4,N-3,2
	II=K2+I
10  W(II)=(9.*(W(II-1)+W(II+1))-(W(II-3)+W(II+3)))/16.
	I1=K2+2
	I2=K2+N-1
	W(I1)=0.5*(W(I1-1)+W(I1+1))
	W(I2)=0.5*(W(I2-1)+W(I2+1))
	RETURN
	END
	SUBROUTINE CORR(NMAX,N,K,M,I1,DX,P,W,AK)
	REAL*8 P(NMAX),W(NMAX),AK(0:M)
	K1=N+K
	IF(I1.EQ.2)GOTO 20
	DO 10 I=1,N,2
	II=K1+I
	J1=MAX0(1,I-M)
	J2=MIN0(N,I+M)
	DO 10 J=J1,J2
	IJ=IABS(I-J)
10  W(II)=W(II)+AK(IJ)*DX*P(K1+J)
	RETURN
20  DO 30 I=2,N,2
	II=K1+I
	J1=MAX0(1,I-M)
	J2=MIN0(N,I+M)
	DO 30 J=J1,J2
	IJ=IABS(I-J)
30  W(II)=W(II)+AK(IJ)*DX*P(K1+J)
	RETURN
	END
	SUBROUTINE WI(NMAX,N,KMIN,KMAX,DX,DX1,P,W)
    REAL*8 P(NMAX),W(NMAX)
	COMMON /COMAK/AK(0:1100)
	K1=N+1
	K=2**(KMAX-KMIN)
	C=ALOG(DX)
	DO 10 I=1,N
	II=K1+I
	W(II)=0.0
	DO 10 J=1,N
	IJ=K*IABS(I-J)
10  W(II)=W(II)+(AK(IJ)+C)*DX1*P(K1+J)
	RETURN
	END
	SUBROUTINE AKCO(KA,KMAX,K,AK1)
	REAL*8 AK1(0:KA)
	COMMON /COMAK/AK(0:1100)
	J=2**(KMAX-K)
	DO 10 I=0,KA
	II=J*I
10  AK1(I)=AK(II)
	RETURN
	END
	SUBROUTINE AKIN(KA,AK1,AK2)
	REAL*8 AK1(KA),AK2(KA)
	DO 10 I=4,KA-3
10  AK2(I)=(9.*(AK1(I-1)+AK1(I+1))-(AK1(I-3)+AK1(I+3)))/16.
	AK2(1)=(9.*AK1(2)-AK1(4))/8.
	AK2(2)=(9.*(AK1(1)+AK1(3))-(AK1(3)+AK1(5)))/16.
	AK2(3)=(9.*(AK1(2)+AK1(4))-(AK1(2)+AK1(6)))/16.
	DO 20 I=1,KA
20  AK2(I)=AK1(I)-AK2(I)
	DO 30 I=1,KA-1,2
	I1=I+1
	AK1(I)=0.0
30  AK1(I1)=AK2(I1)
	RETURN
	END
	SUBROUTINE SUBAK(MM)
	COMMON /COMAK/AK(0:1100)
	DO 10 I=0,MM
10  AK(I)=(I+0.5)*(ALOG(ABS(I+0.5))-1.)-(I-0.5)*(ALOG(ABS(I-0.5))-1.)
	RETURN
	END
	FUNCTION FRICT(N,DX,X,H,P,EDA)
	REAL*8 X(N),H(N),P(N),EDA(N)
	COMMON /COM3/E1,PH,B,U1,U2,R
	DATA TAU0,AT/1.98E7,0.078/
	OPEN (10,FILE='TAU.DAT')
	TP=TAU0/PH
	TE=TAU0/E1
	A=AT/TAU0
	BR=B/R
	FRICT=0.0
	DO 10 I=1,N
	DP=0.0
	A=1.0+AT*P(I)/TAU0
	IF(I.NE.N)DP=(P(I+1)-P(I))/DX
	TAU1=0.5*H(I)*DP*(BR/TP/A)
	TAU2=2.*U1*EDA(I)/(H(I)*BR**2*TE*A)
    FRICT=FRICT+ABS(TAU1)+TAU2
	TAU2=0.05*TAU2
	WRITE(10,5)X(I),TAU1,TAU2,P(I),H(I)
5	FORMAT(5(E12.6,1X))
10  CONTINUE
	FRICT=FRICT*DX*B*TAU0
	RETURN
	END
	SUBROUTINE FZ(N,P,POLD)
	REAL*8 P(N),POLD(N)
	DO 10 I=1,N
10  POLD(I)=P(I)
	RETURN
	END
	SUBROUTINE ERROP(N,P,POLD,ERP)
	REAL*8 P(N),POLD(N)
	SD=0.0
	SUM=0.0
	DO 10 I=1,N
	SD=SD+ABS(P(I)-POLD(I))
	POLD(I)=P(I)
10  SUM=SUM+P(I)
	ERP=SD/SUM
	RETURN
	END
