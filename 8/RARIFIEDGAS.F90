	PROGRAM RARIFIEDGAS
	IMPLICIT REAL*8 (A-H,O-Z)
	DIMENSION P(161,161),H(161,161),X(161),Y(161),F(161,161),QW(161,161)
	DATA AL,B,H0,U,EDA,PA,ALFA,R,T0/4.0E-6,3.3E-6,5.0E-9,25.0,1.8060E-5,1.0135E5,0.01,287.03,293.0/
	DATA N,M/161,161/
	OPEN(8,FILE='FILM.DAT',STATUS='UNKNOWN')
    OPEN(9,FILE='PRESSURE.DAT',STATUS='UNKNOWN')
	PI=3.1415926
	BETA1=0.01
	ALENDA=6.0*EDA*U*AL/(H0**2*PA)
	DELTA=AL*DSIN(ALFA)/H0
	A=AL/B
	D0=PA*H0/EDA/DSQRT(2.0*R*T0)
	DX=1.0/FLOAT(N-1)
	DY=1.0/FLOAT(M-1)
	CALL SUBH(N,M,DX,DY,DELTA,X,Y,H)
	CALL SUBP(N,M,DX,DY,D0,A,ALENDA,BETA1,U,X,Y,H,P,F,QW)
	CALL OUTPUT(N,M,A,ALFA,D0,H0,PA,AL,B,U,X,Y,H,P)
	STOP
	END
	SUBROUTINE SUBH(N,M,DX,DY,DELTA,X,Y,H)
	IMPLICIT REAL*8 (A-H,O-Z)
	DIMENSION X(N),Y(M),H(N,M)
	DO I=1,N
	X(I)=(I-1)*DX
	ENDDO
	DO J=1,M
	Y(J)=(J-1)*DY-0.5
	ENDDO
	DO I=1,N
	DO J=1,M
	H(I,J)=1.0+DELTA*(1.0-X(I))
	ENDDO
	ENDDO
	RETURN
	END
	SUBROUTINE SUBP(N,M,DX,DY,D0,A,ALENDA,BETA1,U,X,Y,H,P,F,QW)
	IMPLICIT REAL*8 (A-H,O-Z)
	DIMENSION X(N),Y(M),H(N,M),P(N,M),F(N,M),QW(N,M)
	DO I=1,N
	DO J=1,M
	P(I,J)=1.0              
	F(I,J)=0.0
	QW(I,J)=1.0
	ENDDO
	ENDDO
	DO I=2,N-1
	DO J=2,M-1
	P(I,J)=P(I-1,J)*H(I-1,J)/H(I,J)
	ENDDO
	ENDDO
	K=0
	DO WHILE(K<10000)
	DO I=1,N
	DO J=1,M
	DR=D0*P(I,J)*H(I,J)
	QC=DR/6.0
	QP=QC+1.0162+0.40134*DLOG(1.0+1.2477/DR)
	QW(I,J)=QP/QC
	ENDDO
	ENDDO
	ERR=0.0
	DO J=2,M-1
	DO I=2,N-1
  	C0=2.0*ALENDA*H(I,J)/DX
	C5=2.0*ALENDA*P(I-1,J)*H(I-1,J)/DX
	TMP1=QW(I+1,J)*H(I+1,J)**3
	TMP2=QW(I,J)*H(I,J)**3
	QHP1=0.5*(TMP1+TMP2)
	TMP1=QW(I-1,J)*H(I-1,J)**3
	QHM1=0.5*(TMP1+TMP2)
	C1=P(I,J)*(QHP1+ QHM1)/DX**2
	C3=(P(I+1,J)**2*QHP1+P(I-1,J)**2*QHM1)/DX**2
	TMP1=QW(I,J+1)*H(I,J+1)**3
	QHP1=0.5*(TMP1+TMP2)
	TMP1=QW(I,J-1)*H(I,J-1)**3
	QHM1=0.5*(TMP1+TMP2)
	C2=A**2*P(I,J)*(QHP1+ QHM1)/DY**2
	C4=A**2*(P(I,J+1)*P(I,J+1)*QHP1+P(I,J-1)*P(I,J-1)*QHM1)/DY**2
	TMP=(C5+C3+C4)/(C0+C1+C2)
	P(I,J)=P(I,J)+BETA1*(TMP-P(I,J))
	F(I,J)=P(I,J)*(C0+C1+C2)-C3-C4-C5
    IF(ABS(F(I,J)).GT.ERR)ERR=ABS(F(I,J))
	ENDDO
	ENDDO
	K=K+1
	WRITE(*,"('K=',I6,6X,'ERR=',E12.6)")K,ERR
	IF(ERR.LT.1.E-5) EXIT
	IF(K.GT.500)BETA1=0.1
	IF(K.GT.2000)BETA1=0.5
	IF(K.GT.3000)BETA1=0.75
	IF(K.GT.5000)BETA1=0.95
    ENDDO
	RETURN
	END
	SUBROUTINE OUTPUT(N,M,A,ALFA,D0,H0,PA,AL,B,U,X,Y,H,P)
	IMPLICIT REAL*8 (A-H,O-Z)
	DIMENSION X(N),Y(M),H(N,M),P(N,M)
	N2=N/2
	SM=0.0
	X0=0.0
	AM0=0.0
	PMAX=0.0
	PMIN=0.0
	DO I=1,N
	DO J=1,M
	P(I,J)=P(I,J)-1.0
	SM=SM+P(I,J)
	AM0=AM0+P(I,J)*(X(N2)-X(I))
	IF(P(I,J).GT.PMAX)THEN
	PMAX=P(I,J)
	IMAX=I
	JMAX=J
	ENDIF
	IF(P(I,J).LT.PMIN)PMIN=P(I,J)
	H(I,J)=H0*H(I,J)
	ENDDO
	ENDDO
	X0=AM0/SM+X(N2)
	AM0=AM0*PA*AL**2*B/(N-1)/(M-1)
	SM=SM*PA*AL*B/(N-1)/(M-1)
	WRITE(8,40)Y(1),(Y(J),J=1,M)
	WRITE(8,40)(X(I),(H(I,J),J=1,M),I=1,N)
	WRITE(9,40)Y(1),(Y(J),J=1,M)
	WRITE(9,40)(X(I),(P(I,J),J=1,M),I=1,N)
40	FORMAT(162(E12.6,1X))
	RETURN
	END